"""
ui.py (safe recovery wrapper)

Este arquivo foi reduzido para uma implementa√ß√£o m√≠nima e est√°vel ap√≥s um
erro de merge ter corrompido a vers√£o anterior. Mantemos apenas a API
necess√°ria para a aplica√ß√£o iniciar: `render_bot_control()`.

Regras do projeto preservadas:
- Login √© exigido por sess√£o (usa st.session_state["logado"]).
- Toda a renderiza√ß√£o principal √© delegada para `dashboard.render_dashboard()`.
- Nada de prints; em caso de erro, exibir via Streamlit.

Se precisar restaurar a UI completa, recupere a vers√£o est√°vel da branch `main`
ou reimplemente incrementalmente a partir deste wrapper.
"""

from __future__ import annotations

import os
import streamlit as st

# Arquivo de sinaliza√ß√£o usado por streamlit_app.py para manter sess√£o autenticada
LOGIN_FILE = ".login_status"


def _require_login() -> None:
    """Exige login por sess√£o antes de renderizar qualquer UI.

    Em dev (APP_ENV=dev), mant√©m comportamento atual do app: se o arquivo
    .login_status existir, consideramos a sess√£o autenticada.
    """
    try:
        if not bool(st.session_state.get("logado", False)):
            # Conveni√™ncia para desenvolvimento local
            if os.environ.get("APP_ENV", "dev").lower() == "dev":
                try:
                    if os.path.exists(LOGIN_FILE):
                        st.session_state["logado"] = True
                        return
                except Exception:
                    pass

            st.title("üîê Login obrigat√≥rio")
            st.warning("Voc√™ precisa estar autenticado para acessar o dashboard.")
            st.stop()
    except Exception:
        st.title("üîê Login obrigat√≥rio")
        st.error("Erro ao verificar autentica√ß√£o. Acesso negado.")
        st.stop()


def render_bot_control():
    """Ponto de entrada usado por streamlit_app.py.

    Delegamos toda a l√≥gica de tela para `dashboard.render_dashboard()` para
    garantir uma UI funcional mesmo ap√≥s o erro de merge.
    """
    _require_login()

    # Renderiza√ß√£o principal
    try:
        import dashboard  # m√≥dulo j√° presente no projeto
    except Exception as e:
        st.error(f"Erro ao carregar m√≥dulo de dashboard: {e}")
        st.stop()

    try:
        dashboard.render_dashboard()
    except Exception as e:
        st.error(f"Erro ao renderizar dashboard: {e}")
        st.stop()


__all__ = ["render_bot_control"]
